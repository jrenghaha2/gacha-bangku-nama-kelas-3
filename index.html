<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Denah Tempat Duduk Kelas</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
<style>:root{--bg-chalkboard:#2c3e50;--ui-paper:#fdfbf7;--ui-wood:#8e44ad;--text-dark:#2c3e50;--text-light:#ecf0f1;--row1-color:#3498db;--row1-bg:linear-gradient(135deg,#ecf6fd 0%,#d6eaf8 100%);--row2-color:#2ecc71;--row2-bg:linear-gradient(135deg,#eafaf1 0%,#d5f5e3 100%);--row3-color:#f39c12;--row3-bg:linear-gradient(135deg,#fef9e7 0%,#fdebd0 100%);--desk-border:#d35400}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}html[data-theme="dark"]{--bg-chalkboard:#1a1a1a;--ui-paper:#2d2d2d;--ui-wood:#bb86fc;--text-dark:#e0e0e0;--text-light:#ffffff}body{font-family:'Quicksand',sans-serif;background-color:var(--bg-chalkboard);background-image:linear-gradient(rgba(255,255,255,0.05) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,0.05) 1px,transparent 1px);background-size:20px 20px;min-height:100vh;margin:0;padding:15px;color:var(--text-light);overflow-x:hidden}::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background:rgba(0,0,0,0.1)}::-webkit-scrollbar-thumb{background:var(--ui-wood);border-radius:4px}.container{width:100%;max-width:1200px;margin:0 auto}.header-section{display:flex;align-items:flex-end;justify-content:flex-start;margin-bottom:30px;gap:20px;flex-wrap:wrap;padding-left:10px;position:relative;z-index:5}.teacher-desk{width:200px;height:90px;background:linear-gradient(to bottom,#a86540,#8d5534);color:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;border:3px solid #6d4128;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,0.3);flex-shrink:0;position:relative;font-family:'Poppins',sans-serif;font-weight:700;font-size:20px;letter-spacing:1px;text-shadow:1px 1px 2px rgba(0,0,0,0.5)}.teacher-desk::before{content:"üè´ ABSENSI KELAS";font-size:10px;opacity:0.9;letter-spacing:1px;margin-bottom:2px;font-family:'Quicksand',sans-serif;color:#f0f0f0}.controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;padding-bottom:5px;position:relative;width:auto}.btn-school{background:var(--ui-paper);color:var(--text-dark);border:2px solid var(--ui-wood);border-radius:12px;padding:10px 24px;font-size:14px;font-weight:bold;cursor:pointer;font-family:'Poppins',sans-serif;position:relative;overflow:hidden;user-select:none;box-shadow:0 3px 0 var(--ui-wood),0 4px 8px rgba(0,0,0,0.2);transition:all 0.1s;display:flex;align-items:center;gap:8px}.btn-school:hover{opacity:0.9}.btn-school:active{transform:translateY(3px);box-shadow:0 0 0 var(--ui-wood)}.btn-main-action{background:#3498db;color:white;border-color:#2980b9;box-shadow:0 3px 0 #2980b9,0 4px 8px rgba(0,0,0,0.2)}.chalk-icon{width:14px;height:14px;background:#fff;border-radius:2px;display:inline-block;border:1px solid #ccc}.classroom-grid{display:grid;gap:15px;padding:15px;align-items:center;background:rgba(255,255,255,0.05);border-radius:15px;border:2px dashed rgba(255,255,255,0.2)}.seat{aspect-ratio:4/5;position:relative;display:flex;flex-direction:column;justify-content:flex-start;align-items:center;padding:0;border-radius:8px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,0.2);transition:all 0.3s ease;min-height:120px;border:3px solid var(--desk-border);background-color:var(--ui-paper);cursor:grab}.seat.dragging{opacity:0.5;cursor:grabbing}.seat.drag-over{transform:scale(1.05);box-shadow:0 8px 20px rgba(0,0,0,0.4)}.seat-row-0{background:var(--row1-bg);border-bottom:6px solid var(--row1-color)}.seat-row-1{background:var(--row2-bg);border-bottom:6px solid var(--row2-color)}.seat-row-2{background:var(--row3-bg);border-bottom:6px solid var(--row3-color)}.seat:hover{transform:translateY(-5px) scale(1.02);z-index:2;box-shadow:0 8px 15px rgba(0,0,0,0.3)}.char-img-container{width:100%;height:72%;overflow:hidden;position:relative;background-color:rgba(255,255,255,0.5);border-bottom:2px solid rgba(0,0,0,0.1)}.char-img{width:100%;height:100%;object-fit:cover;transition:0.3s}.seat:hover .char-img{transform:scale(1.05)}.char-info{width:100%;height:28%;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:2px 5px;position:relative;color:#000}.seat.is-locked .char-img{filter:grayscale(1) contrast(0.8);opacity:0.5}.seat.is-locked{border-color:#c0392b !important}.lock-box,.hide-desk-btn,.gender-btn{position:absolute;width:28px;height:28px;background:var(--ui-paper);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:20;transition:0.2s;border:2px solid;color:var(--text-dark);font-size:14px}.lock-box{top:5px;right:5px;border-color:var(--desk-border)}.lock-box:hover{background:var(--desk-border);color:#fff}.hide-desk-btn{top:5px;left:5px;border-color:#e74c3c;color:#e74c3c;font-size:12px;font-weight:bold}.hide-desk-btn:hover{background:#e74c3c;color:#fff}.gender-btn{top:38px;left:5px;border-color:#2ecc71;color:#2ecc71;font-size:14px}.gender-btn:hover{background:#2ecc71;color:#fff}.seat.is-disabled{background:rgba(0,0,0,0.15);border:2px dashed rgba(255,255,255,0.3);box-shadow:none;cursor:pointer;justify-content:center;align-items:center}.seat.is-disabled:hover{background:rgba(255,255,255,0.1);transform:none}.seat.is-disabled *{display:none}.seat.is-disabled::after{content:"+ Buka Meja";color:rgba(255,255,255,0.6);font-family:'Poppins',sans-serif;font-size:12px;font-weight:bold}.seat-name{font-weight:700;text-align:center;width:100%;line-height:1.2;text-transform:uppercase;color:#000 !important;margin-bottom:0;z-index:2;font-family:'Poppins',sans-serif}.text-normal{font-size:12px}.text-medium{font-size:10px}.text-small{font-size:9px}.text-tiny{font-size:8px}.seat-number{position:absolute;bottom:2px;right:4px;font-size:9px;color:rgba(0,0,0,0.4);font-weight:bold}.modal{display:none;position:fixed;z-index:999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.6);backdrop-filter:blur(3px);overflow-y:auto}.modal.show{display:block}.modal-content{background:var(--ui-paper);color:var(--text-dark);margin:5% auto;padding:25px;width:90%;max-width:550px;border-radius:12px;height:80vh;max-height:80vh;display:flex;flex-direction:column;box-shadow:0 0 0 4px rgba(255,255,255,0.5),0 15px 40px rgba(0,0,0,0.5);position:relative;border:3px solid var(--ui-wood)}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;border-bottom:2px dashed rgba(0,0,0,0.1);padding-bottom:10px}.modal-title{margin:0;font-family:'Poppins',sans-serif;color:var(--ui-wood);font-size:22px;font-weight:700}.close-btn{width:30px;height:30px;background:#eee;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;cursor:pointer;color:#555;transition:0.2s;border:none}.close-btn:hover{background:#c0392b;color:#fff}.manager-input{width:100%;padding:12px;border:2px solid #ddd;background:#fff;border-radius:10px;font-family:inherit;font-weight:bold;color:var(--text-dark);margin-bottom:10px}.manager-input:focus{outline:0;border-color:var(--ui-wood)}.name-list{flex:1 1 auto;min-height:0;overflow-y:auto;background:rgba(0,0,0,0.03);padding:10px;border-radius:8px;margin:10px 0;border:1px solid rgba(0,0,0,0.1)}.name-item{padding:10px 15px;margin-bottom:8px;border-radius:8px;background:#fff;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 5px rgba(0,0,0,0.05);transition:0.1s;color:var(--text-dark);font-weight:700;border:1px solid #eee}.name-item:hover{transform:translateX(3px);border-left:4px solid var(--ui-wood)}.name-item.eliminated span{opacity:0.5;text-decoration:line-through;color:#c0392b}.action-btn{width:28px;height:28px;border-radius:8px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;margin-left:5px;font-size:12px;transition:0.2s}.action-btn:active{transform:translateY(2px)}.btn-status-on{background:#abebc6;color:#27ae60;width:auto;padding:0 10px}.btn-status-off{background:#fadbd8;color:#c0392b;width:auto;padding:0 10px}.btn-edit{background:#d4e4ff;color:#2980b9}.btn-del{background:#fadbd8;color:#c0392b}textarea.manager-input{flex:1 1 auto;min-height:0;overflow-y:auto;padding:15px;border-radius:8px;border:2px solid #ddd;font-family:monospace;color:var(--text-dark);background:#fff;resize:none;margin-bottom:15px}textarea.manager-input:focus{outline:0;border-color:var(--ui-wood)}.modal-footer{display:grid;grid-template-columns:1fr 1fr;gap:10px}.toast{position:fixed;bottom:20px;right:20px;z-index:2000;background:#2c3e50;color:#fff;padding:15px 20px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.3);animation:slideIn 0.3s ease;max-width:300px}.toast.success{background:#27ae60}.toast.error{background:#c0392b}.toast.info{background:#3498db}@keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}.stats-panel{display:none;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;margin-bottom:20px;padding:15px;background:rgba(255,255,255,0.1);border-radius:12px;position:relative}.stat-card{background:var(--ui-paper);padding:15px;border-radius:8px;text-align:center;border-left:4px solid var(--ui-wood)}.stat-value{font-size:24px;font-weight:700;color:var(--ui-wood)}.stat-label{font-size:12px;color:#7f8c8d;margin-top:5px}.theme-toggle{position:fixed;top:20px;right:20px;z-index:50;background:var(--ui-paper);border:2px solid var(--ui-wood);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:20px;transition:0.3s}.theme-toggle:hover{transform:rotate(20deg)}@media (max-width:768px){.header-section{flex-direction:column;align-items:center;padding-left:0;gap:10px}.controls{justify-content:center;display:grid;grid-template-columns:1fr 1fr;gap:10px}.classroom-grid{grid-template-columns:repeat(2,1fr) !important;gap:8px;padding:8px}.seat{min-height:85px;flex-direction:row;justify-content:space-between}.char-img-container{width:70px;height:100%;border-right:2px solid var(--desk-border)}.char-info{width:calc(100% - 70px)}.modal-content{height:90vh;width:95%}}@media print{.controls,.modal,.lock-box,.gender-btn,.hide-desk-btn,.theme-toggle,.stats-panel{display:none !important}body{background:#fff}}</style>
</head>
<body>
<div class="theme-toggle" onclick="toggleDarkMode()" title="Dark/Light Mode">üåô</div>
<div class="container">
<div class="header-section">
<div class="teacher-desk">MEJA GURU</div>
<div class="controls">
<button class="btn-school btn-main-action" onclick="handleShuffle()"><div class="chalk-icon"></div> ACAK POSISI</button>
<button class="btn-school" onclick="handleOpenManager()">üìã DATA SISWA</button>
<button class="btn-school" onclick="handleOpenSettings()">‚öôÔ∏è PENGATURAN KELAS</button>
<button class="btn-school" onclick="handleShowStats()">üìä STATISTIK</button>
<button class="btn-school" onclick="handlePrint()">üñ®Ô∏è CETAK</button>
</div>
</div>
<div id="statsPanel" class="stats-panel"></div>
<div id="classroom" class="classroom-grid"></div>
</div>
<div id="mainModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="modal-title" id="modalTitle">BUKU ABSEN SISWA</h2>
<button class="close-btn" onclick="handleCloseModal()">‚úï</button>
</div>
<div id="normalView" style="display:flex;flex-direction:column;flex:1;min-height:0;">
<div style="font-size:13px;margin-bottom:10px;color:#7f8c8d;font-weight:bold;">Total Siswa: <span id="studentCount">0</span> Siswa</div>
<div style="display:flex;gap:10px;margin-bottom:10px;flex-shrink:0;">
<input type="text" id="newNameInput" class="manager-input" placeholder="Nama siswa baru..." style="margin:0;flex:1;">
<button class="btn-school btn-main-action" onclick="handleAddName()" style="padding:0 20px;">TAMBAH</button>
</div>
<div style="display:flex;gap:10px;margin-bottom:10px;flex-shrink:0;">
<input type="text" id="searchInput" class="manager-input" placeholder="üîç Cari..." style="margin:0;flex:1;" onkeyup="renderNameList()">
<button class="btn-school" onclick="handleOpenBulk()" style="padding:0 15px;">üìù BANYAK</button>
<button class="btn-school" onclick="handleOpenSort()" style="padding:0 15px;">‚ÜïÔ∏è URUT</button>
</div>
<div class="name-list" id="nameListContainer"></div>
<div class="modal-footer">
<button class="btn-school" style="color:#c0392b;background:#fce4ec;border-color:#edaebb;justify-content:center;" onclick="handleEliminateAll()">ABSEN SEMUA</button>
<button class="btn-school" style="color:#27ae60;background:#e8f8f5;border-color:#aedeba;justify-content:center;" onclick="handleRestoreAll()">HADIR SEMUA</button>
<button class="btn-school" style="grid-column:span 2;background:#eee;color:#555;justify-content:center;" onclick="handleResetDefault()">RESET</button>
</div>
</div>
<div id="bulkView" style="display:none;flex-direction:column;flex:1;min-height:0;">
<p style="margin:10px 0 5px 0;font-size:13px;color:#7f8c8d;font-weight:bold;">Input nama (1 per baris):</p>
<textarea id="bulkEditArea" class="manager-input" placeholder="BUDI&#10;SITI&#10;AYU"></textarea>
<div style="display:flex;gap:10px;flex-shrink:0;">
<button class="btn-school" style="flex:1;color:#c0392b;background:#fce4ec;" onclick="handleCloseModal()">Batal</button>
<button class="btn-school btn-main-action" style="flex:1;" onclick="handleSaveBulk()">SIMPAN</button>
</div>
</div>
<div id="sortView" style="display:none;flex-direction:column;flex:1;min-height:0;">
<p style="margin:15px 0;font-weight:bold;">Pilih urutan:</p>
<button class="btn-school" style="margin-bottom:10px;justify-content:center;" onclick="handleSort('alpha');handleCloseModal();">A-Z</button>
<button class="btn-school" style="margin-bottom:10px;justify-content:center;" onclick="handleSort('status');handleCloseModal();">Status</button>
<button class="btn-school" style="background:#fce4ec;color:#c0392b;justify-content:center;" onclick="handleCloseModal()">Batal</button>
</div>
<div id="settingsView" style="display:none;flex-direction:column;flex:1;min-height:0;overflow-y:auto;padding:10px 0;">
<label style="font-weight:bold;display:block;margin-bottom:5px;">Jumlah Baris:</label>
<input type="number" id="inputRows" class="manager-input" min="1" max="10" value="3" style="margin-bottom:15px;">
<label style="font-weight:bold;display:block;margin-bottom:5px;">Jumlah Kolom:</label>
<input type="number" id="inputCols" class="manager-input" min="1" max="15" value="6" style="margin-bottom:15px;">
<button class="btn-school btn-main-action" style="width:100%;justify-content:center;margin-bottom:20px;" onclick="handleApplyGrid()">SIMPAN GRID</button>
<hr style="margin:15px 0;border:1px solid #ddd;">
<label style="font-weight:bold;display:block;margin-bottom:10px;">üíæ BACKUP DATA:</label>
<button class="btn-school" style="width:100%;justify-content:center;margin-bottom:8px;background:#d4e4ff;border-color:#3498db;color:#2980b9;" onclick="handleSaveJSON()">üíæ SAVE JSON</button>
<button class="btn-school" style="width:100%;justify-content:center;background:#e8f8f5;border-color:#27ae60;color:#27ae60;" onclick="handleLoadJSON()">üìÇ LOAD JSON</button>
<input type="file" id="fileInput" accept=".json" style="display:none;" onchange="loadJSONFile(event)">
</div>
</div>
</div>
<script>const knownGenders={"RAHMA":"F","TASYA":"F","AKHSIN AMIRULLOH":"M","ZERLINA":"F","YEHEZKIEL RAMLAN":"M","MAYANG":"F","NATASHA":"F","GALIH":"M","MURSID":"M","IFA":"F","KRIS":"M","HARIS":"M","DESPIA":"F","FAIQ":"M","ANGGUN":"F","REGA":"F","DENDRA":"M","IYAN.":"M"};const defaultNames=Object.keys(knownGenders);let masterNames=defaultNames.map(name=>({name:name,active:true}));let seats=[];let totalRows=3;let totalCols=6;let history=[];let historyIndex=-1;function handleOpenManager(){document.getElementById('mainModal').classList.add('show');document.getElementById('normalView').style.display='flex';document.getElementById('bulkView').style.display='none';document.getElementById('sortView').style.display='none';document.getElementById('settingsView').style.display='none';document.getElementById('modalTitle').textContent='BUKU ABSEN SISWA';renderNameList()}function handleOpenSettings(){document.getElementById('mainModal').classList.add('show');document.getElementById('normalView').style.display='none';document.getElementById('bulkView').style.display='none';document.getElementById('sortView').style.display='none';document.getElementById('settingsView').style.display='flex';document.getElementById('modalTitle').textContent='‚öôÔ∏è PENGATURAN KELAS';document.getElementById('inputRows').value=totalRows;document.getElementById('inputCols').value=totalCols}function handleOpenBulk(){document.getElementById('normalView').style.display='none';document.getElementById('bulkView').style.display='flex';document.getElementById('sortView').style.display='none';document.getElementById('settingsView').style.display='none';document.getElementById('modalTitle').textContent='üìù INPUT BANYAK';document.getElementById('bulkEditArea').value=masterNames.map(n=>n.name).join('\n')}function handleOpenSort(){document.getElementById('normalView').style.display='none';document.getElementById('bulkView').style.display='none';document.getElementById('sortView').style.display='flex';document.getElementById('settingsView').style.display='none';document.getElementById('modalTitle').textContent='‚ÜïÔ∏è URUTKAN DATA'}function handleCloseModal(){document.getElementById('mainModal').classList.remove('show')}function handleShuffle(){distributeNames();saveToHistory();renderSeats();saveState();showToast('Posisi diacak ‚úì','success')}function handleShowStats(){const panel=document.getElementById('statsPanel');if(panel.style.display==='grid'){panel.style.display='none';return}const present=masterNames.filter(n=>n.active).length;const absent=masterNames.length-present;const activeSeats=getActiveSeatCount();const occupancy=activeSeats>0?((present/activeSeats)*100).toFixed(1):0;panel.innerHTML=`<div class="stat-card"><div class="stat-value">${masterNames.length}</div><div class="stat-label">Total</div></div><div class="stat-card"><div class="stat-value">${present}</div><div class="stat-label">Hadir</div></div><div class="stat-card"><div class="stat-value">${absent}</div><div class="stat-label">Absen</div></div><div class="stat-card"><div class="stat-value">${activeSeats}</div><div class="stat-label">Kursi</div></div><div class="stat-card"><div class="stat-value">${occupancy}%</div><div class="stat-label">Okupansi</div></div>`;panel.style.display='grid'}function handlePrint(){window.print()}function handleAddName(){const val=document.getElementById('newNameInput').value.trim().toUpperCase();const maxS=getActiveSeatCount();if(val&&masterNames.length<maxS){masterNames.push({name:val,active:true});document.getElementById('newNameInput').value='';renderNameList();distributeNames();saveToHistory();renderSeats();saveState();showToast(`${val} ditambahkan ‚úì`,'success')}}function handleSaveBulk(){const lines=document.getElementById('bulkEditArea').value.split('\n').map(s=>s.trim().toUpperCase()).filter(s=>s);const maxS=getActiveSeatCount();if(lines.length>maxS){showToast(`Max ${maxS} siswa!`,'error');return}masterNames=lines.map(n=>({name:n,active:true}));seats.forEach(s=>{s.currentName="";s.locked=false});distributeNames();saveToHistory();renderSeats();saveState();handleCloseModal();showToast('Data disimpan ‚úì','success')}function handleSort(type){if(type==='alpha')masterNames.sort((a,b)=>a.name.localeCompare(b.name));else masterNames.sort((a,b)=>b.active-a.active);distributeNames();saveToHistory();renderSeats();saveState();showToast('Data diurutkan ‚úì','success')}function handleApplyGrid(){const r=parseInt(document.getElementById('inputRows').value);const c=parseInt(document.getElementById('inputCols').value);if(r>0&&c>0){totalRows=r;totalCols=c;initSeats();saveState();handleCloseModal();showToast('Grid disimpan ‚úì','success')}}function handleEliminateAll(){if(confirm("Tandai semua ABSEN?")){masterNames.forEach(n=>n.active=false);renderNameList();distributeNames();saveToHistory();renderSeats();saveState();showToast('Semua ABSEN','info')}}function handleRestoreAll(){masterNames.forEach(n=>n.active=true);renderNameList();distributeNames();saveToHistory();renderSeats();saveState();showToast('Semua HADIR','info')}function handleResetDefault(){if(confirm("Reset ke data awal?")){masterNames=defaultNames.map(n=>({name:n,active:true}));renderNameList();seats.forEach(s=>{s.currentName="";s.locked=false});distributeNames();saveToHistory();renderSeats();saveState();showToast('Data direset ‚úì','info')}}function handleSaveJSON(){const data={masterNames,seats,totalRows,totalCols,date:new Date().toLocaleString()};const json=JSON.stringify(data,null,2);const blob=new Blob([json],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`denah_${new Date().toISOString().split('T')[0]}.json`;a.click();URL.revokeObjectURL(url);showToast('‚úÖ JSON berhasil disave!','success')}function handleLoadJSON(){document.getElementById('fileInput').click()}function loadJSONFile(event){const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=(e)=>{try{const data=JSON.parse(e.target.result);if(confirm('‚ö†Ô∏è Load data ini?
\nData lama akan diganti!')){masterNames=data.masterNames||[];seats=data.seats||[];totalRows=data.totalRows||3;totalCols=data.totalCols||6;document.getElementById('classroom').style.gridTemplateColumns=`repeat(${totalCols}, 1fr)`;saveState();renderSeats();handleCloseModal();showToast('‚úÖ JSON berhasil diload!','success')}}catch(e){showToast('‚ùå File tidak valid!','error')}}};reader.readAsText(file);event.target.value=''}function showToast(msg,type='info'){const toast=document.createElement('div');toast.className=`toast ${type}`;toast.textContent=msg;document.body.appendChild(toast);setTimeout(()=>toast.remove(),3000)}function loadData(){const saved=localStorage.getItem('gacha_class');if(saved){const data=JSON.parse(saved);masterNames=data.masterNames||[];seats=data.seats||[];totalRows=data.totalRows||3;totalCols=data.totalCols||6;return true}return false}function saveState(){localStorage.setItem('gacha_class',JSON.stringify({masterNames,seats,totalRows,totalCols}))}function saveToHistory(){history=history.slice(0,historyIndex+1);history.push(JSON.stringify({masterNames,seats}));historyIndex++}function getActiveSeatCount(){return seats.filter(s=>!s.disabled).length}function detectGender(name){if(knownGenders[name])return knownGenders[name];const n=name.toUpperCase();const femaleWords=["PUTRI","AYU","NUR","SITI","INTAN","SARI"];const maleWords=["PUTRA","AKBAR","FAHMI","ILHAM","BUDI","JOKO"];for(let w of n.split(" ")){if(femaleWords.some(fw=>w===fw))return"F";if(maleWords.some(mw=>w===mw))return"M"}return n.slice(-1).match(/[AIE]/)?"F":"M"}function getAvatarUrl(name){const gender=detectGender(name);const maleSvg=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="#e8f4f8"/><circle cx="50" cy="35" r="20" fill="#2c3e50"/><path d="M15 100 C 15 50, 85 50, 85 100" fill="#2c3e50"/></svg>`;const femaleSvg=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="#fce4ec"/><circle cx="50" cy="35" r="20" fill="#2c3e50"/><path d="M20 60 L80 60 L75 100 L25 100 Z" fill="#2c3e50"/></svg>`;return gender==="F"?"data:image/svg+xml;utf8,"+encodeURIComponent(femaleSvg):"data:image/svg+xml;utf8,"+encodeURIComponent(maleSvg)}function toggleDarkMode(){const current=localStorage.getItem('theme');const newTheme=current==='dark'?'light':'dark';localStorage.setItem('theme',newTheme);document.documentElement.setAttribute('data-theme',newTheme);document.querySelector('.theme-toggle').textContent=newTheme==='dark'?'‚òÄÔ∏è':'üåô'}function initSeats(){seats=[];const maxS=totalRows*totalCols;document.getElementById('classroom').style.gridTemplateColumns=`repeat(${totalCols}, 1fr)`;for(let i=0;i<maxS;i++)seats.push({id:i,currentName:"",locked:false,disabled:false});distributeNames();renderSeats()}function distributeNames(){const locked=seats.filter(s=>s.locked&&!s.disabled&&s.currentName).map(s=>s.currentName);let available=masterNames.filter(n=>n.active).map(n=>n.name).filter(name=>!locked.includes(name));for(let i=available.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[available[i],available[j]]=[available[j],available[i]]}seats.forEach(seat=>{if(!seat.locked&&!seat.disabled)seat.currentName=available.shift()||""})}function renderSeats(){const container=document.getElementById('classroom');container.innerHTML='';for(let row=0;row<totalRows;row++){for(let col=0;col<totalCols;col++){const idx=row*totalCols+col;const seat=seats[idx];const div=document.createElement('div');if(seat.disabled){div.className='seat is-disabled';div.onclick=()=>{seat.disabled=false;distributeNames();renderSeats();saveState()}}else{const rowClass=`seat-row-${row%3}`;div.className=`seat ${rowClass} ${seat.locked?'is-locked':''}`;const name=seat.currentName;const avatar=getAvatarUrl(name);let fontSize="text-normal";if(name.length>18)fontSize="text-tiny";else if(name.length>12)fontSize="text-small";else if(name.length>8)fontSize="text-medium";div.innerHTML=`<div class="hide-desk-btn" onclick="seats[${idx}].disabled = true; distributeNames(); renderSeats(); saveState();">‚úñ</div><div class="lock-box" onclick="if (seats[${idx}].currentName) seats[${idx}].locked = !seats[${idx}].locked; renderSeats(); saveState();">${seat.locked?'üîí':'üîì'}</div><div class="char-img-container"><img src="${avatar}" class="char-img" alt="${name}" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=85c1e9&color=fff'"></div><div class="char-info"><div class="seat-name ${fontSize}">${name||"KOSONG"}</div></div><div class="seat-number">MEJA ${col+1}</div>`}container.appendChild(div)}}document.getElementById('studentCount').textContent=masterNames.length}function renderNameList(){const list=document.getElementById('nameListContainer');const q=document.getElementById('searchInput').value.toUpperCase();list.innerHTML='';masterNames.forEach((item,idx)=>{if(item.name.includes(q)){const div=document.createElement('div');div.className=`name-item ${!item.active?'eliminated':''}`;const btn=item.active?'HADIR':'ABSEN';const cls=item.active?'btn-status-on':'btn-status-off';div.innerHTML=`<span>${item.name}</span><div style="display:flex;"><button class="action-btn ${cls}" onclick="masterNames[${idx}].active = !masterNames[${idx}].active; renderNameList(); distributeNames(); saveToHistory(); renderSeats(); saveState();">${btn}</button><button class="action-btn btn-edit" onclick="const n = prompt('Nama:', masterNames[${idx}].name); if(n) { const old = masterNames[${idx}].name; masterNames[${idx}].name = n; seats.forEach(s => { if(s.currentName === old) s.currentName = n; }); renderNameList(); renderSeats(); saveState(); }">‚úé</button><button class="action-btn btn-del" onclick="if(confirm('Hapus?')) { masterNames.splice(${idx}, 1); renderNameList(); distributeNames(); renderSeats(); saveState(); }">üóë</button></div>`;list.appendChild(div)}})}window.addEventListener('load',()=>{if(!loadData())initSeats();else{document.getElementById('classroom').style.gridTemplateColumns=`repeat(${totalCols}, 1fr)`;renderSeats()}const theme=localStorage.getItem('theme');if(theme==='dark'){document.documentElement.setAttribute('data-theme','dark');document.querySelector('.theme-toggle').textContent='‚òÄÔ∏è'}});document.addEventListener('keydown',(e)=>{if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA')return;if(e.ctrlKey&&e.key==='a'){e.preventDefault();handleShuffle()}});</script>
</body>
</html>
